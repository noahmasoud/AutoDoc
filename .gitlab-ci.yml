###########################################
# GitLab CI Configuration for AutoDoc
###########################################
stages:
  - test

autodoc-test:
  stage: test
  image: ghcr.io/noahmasoud/autodoc-ci:dev

  script:
    - echo "=================================="
    - echo "AutoDoc CI Environment (GitLab)"
    - echo "=================================="
    - echo "Commit SHA: $CI_COMMIT_SHA"
    - echo "Repository: $CI_PROJECT_PATH"
    - echo "Branch: $CI_COMMIT_BRANCH"
    - echo "Pipeline ID: $CI_PIPELINE_ID"
    - echo "=================================="
    
    - ./autodoc.sh 
        --commit "$CI_COMMIT_SHA" 
        --repo "$CI_PROJECT_PATH" 
        --branch "$CI_COMMIT_BRANCH" 
        --verbose
    
    - echo "âœ“ AutoDoc analysis completed"
    - cat change_report.json

  artifacts:
    paths:
      - change_report.json
    expire_in: 30 days

  rules:
    - if: $CI_COMMIT_BRANCH == "main"
    - if: $CI_COMMIT_BRANCH == "dev"