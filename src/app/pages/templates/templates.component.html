<div class="page-container">
    <!-- Header -->
    <div class="page-header">
        <h2>Templates</h2>
        <button class="btn btn-primary" (click)="openCreateDialog()">
            + Create Template
        </button>
    </div>

    <!-- Search Bar -->
    <div class="search-bar">
        <input type="text" [(ngModel)]="searchQuery" (input)="filterTemplates()"
            placeholder="Search templates by name or format..." class="search-input" />
    </div>

    <!-- Error Message -->
    <div *ngIf="error && !showEditor" class="alert alert-error">
        {{ error }}
    </div>

    <!-- Loading State -->
    <div *ngIf="loading && !showEditor" class="loading">
        Loading templates...
    </div>

    <!-- Templates List -->
    <div *ngIf="!loading && !showEditor" class="templates-grid">
        <div *ngFor="let template of filteredTemplates" class="template-card">
            <div class="template-header">
                <h3>{{ template.name }}</h3>
                <span class="format-badge">{{ template.format }}</span>
            </div>

            <div class="template-body">
                <pre>{{ template.body | slice:0:150 }}{{ template.body.length > 150 ? '...' : '' }}</pre>
            </div>

            <div class="template-meta" *ngIf="template.variables">
                <span class="meta-label">Variables:</span>
                <span class="variable-tag" *ngFor="let key of getVariableKeys(template.variables)">
                    {{ key }}
                </span>
            </div>

            <div class="template-actions">
                <button class="btn btn-secondary" (click)="openEditDialog(template)">
                    Edit
                </button>
                <button class="btn btn-danger" (click)="deleteTemplate(template)">
                    Delete
                </button>
            </div>
        </div>

        <!-- Empty State -->
        <div *ngIf="filteredTemplates.length === 0" class="empty-state">
            <p>{{ searchQuery ? 'No templates match your search' : 'No templates yet. Create your first template!' }}
            </p>
        </div>
    </div>

    <!-- Editor Modal -->
    <div *ngIf="showEditor" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>{{ editingTemplate ? 'Edit Template' : 'Create Template' }}</h3>
                <button class="btn-close" (click)="closeEditor()">Ã—</button>
            </div>

            <div class="modal-body">
                <!-- Error Message -->
                <div *ngIf="error" class="alert alert-error">
                    {{ error }}
                </div>

                <!-- Form -->
                <form (ngSubmit)="saveTemplate()">
                    <div class="form-group">
                        <label for="name">Template Name *</label>
                        <input id="name" type="text" [(ngModel)]="templateForm.name" name="name" class="form-control"
                            placeholder="e.g., Function Documentation" required />
                    </div>

                    <div class="form-group">
                        <label for="format">Format *</label>
                        <select id="format" [(ngModel)]="templateForm.format" name="format" class="form-control"
                            required>
                            <option value="Markdown">Markdown</option>
                            <option value="Storage">Confluence Storage Format</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="body">Template Body *</label>
                        <textarea id="body" [(ngModel)]="templateForm.body" name="body" class="form-control" rows="10"
                            placeholder="Enter your template content here. Use double curly braces for placeholders."
                            required></textarea>
                        <small class="form-hint">
                            Use double curly braces for variables: <code>{{'{{'}}symbol_name{{'}}'}}</code>
                        </small>
                    </div>

                    <div class="modal-actions">
                        <button type="button" class="btn btn-secondary" (click)="closeEditor()">
                            Cancel
                        </button>
                        <button type="submit" class="btn btn-primary" [disabled]="loading">
                            {{ loading ? 'Saving...' : (editingTemplate ? 'Update' : 'Create') }}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>